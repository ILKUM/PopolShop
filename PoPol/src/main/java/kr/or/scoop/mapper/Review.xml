<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.or.scoop.dao.BoardDao">
	<insert id="insertReview" parameterType="kr.or.scoop.dto.Review">
	insert into reboard (reseq,retitle,recontent,rephoto,email,relike,rernum,retime)
  		values (RESEQ_REBOARD_SEQ.NEXTVAL,#{retitle,jdbcType=VARCHAR},#{recontent,jdbcType=VARCHAR},#{rephoto,jdbcType=VARCHAR},#{email,jdbcType=VARCHAR},#{relike,jdbcType=INTEGER},#{rernum,jdbcType=INTEGER},SYSDATE)
	</insert>
	<select id="getReview" resultType="kr.or.scoop.dto.Review">
	select m.name,r.reseq,r.retitle,r.retime,r.relike,r.rernum from member m join reboard r on m.email = r.email
	</select>
	<select id="selectReview" resultType="kr.or.scoop.dto.Review">
		select r.retitle,r.reseq,r.recontent,r.retime,r.relike,r.rephoto,r.email, m.name from reboard r join member m on r.email = m.email where r.reseq = #{reseq}
	</select>
	<update id="rernumCount">
		 update reboard set rernum=rernum+1 where reseq = #{reseq}
	</update>
	<insert id="insertRelike" parameterType="kr.or.scoop.dto.Review">
		insert into reviewmem(rvseq,reseq,email) 
		values (RVSEQ_REVIEWMEM_SEQ.NEXTVAL,#{param1},#{param2})
	</insert>
	<update id="relikeCount" parameterType="kr.or.scoop.dto.Review">
		update reboard set relike = relike+1 where reseq = #{reseq}
	</update>
	<select id="getrelike" resultType="int">
		select count(*) from reviewmem where email = #{param1} and reseq = #{param2}
	</select>
	<delete id="deleteRelike">
		delete from reviewmem where email = #{email,jdbcType=VARCHAR} and reseq = #{reseq,jdbcType=INTEGER}
	</delete>
	<insert id="reviewComment" parameterType="kr.or.scoop.dto.RvReply">
	insert into RVREPLY(rvrseq, rvrcontent, email, rvrtime, reseq)
  	values(rvrseq_rvreply_seq.nextval, #{param3}, #{param2}, sysdate, #{param1})
	</insert>
	<select id="reviewCommentOk" resultType="kr.or.scoop.dto.RvReply">
	select r.rvrseq,r.reseq,r.rvrcontent,r.rvrtime,m.email,m.name from rvreply r join member m on r.email=m.email where reseq = #{reseq}
	</select>
</mapper>